---
title: "Premium Calculation"
author: "Sarah Kircher"
date: "3/4/2024"
output: html_notebook
---

```{r}
rm(list = ls())
library(dplyr)
library(tidyverse)
library(readxl)
library(writexl)
```

```{r}
# Read in data
superlife_inforce <- read.csv("~/Desktop/2024 Case Study Challenge/2024-srcsc-superlife-inforce-dataset.csv", header = T)
mortality_table <- read_excel("~/Desktop/2024 Case Study Challenge/full_mortality_table.xlsx")

# Make indicator variables for male, smoker, and uw risk value
new_inforce <- superlife_inforce %>%
  select(Policy.type, Face.amount, Issue.year, Issue.age, Sex, Smoker.Status, Underwriting.Class, Death.indicator, Year.of.Death, Lapse.Indicator, Year.of.Lapse)

new_inforce2 <- replace(new_inforce, is.na(new_inforce), 0)

new_inforce2 <- new_inforce2 %>%
  mutate(alive_notlapse = ifelse(Death.indicator == 1 | Lapse.Indicator == 1, 0, 1)) %>%
  mutate(male = ifelse(Sex == "M", 1, 0)) %>%
  mutate(smoker = ifelse(Smoker.Status == "S", 1, 0)) %>%
  mutate(uw_risk_value = ifelse(Underwriting.Class == "very low risk" | Underwriting.Class == "low risk", 0, 1)) %>%
  mutate(duration = 120 - Issue.age)
                            
final_inforce <- new_inforce2 %>%
  select(Policy.type, Face.amount, alive_notlapse, Issue.age, male, smoker, uw_risk_value, duration)

```

# Create 48 Groups - 24 groups for each policy type

```{r}
# Male, non-smoker, low risk, SPWL
M_NS_LR_25to54_SPWL <- final_inforce %>%
  filter(male == 1, smoker == 0, uw_risk_value == 0, Issue.age >= 25 & Issue.age <= 54, Policy.type == "SPWL")

M_NS_LR_55to64_SPWL <- final_inforce %>%
  filter(male == 1, smoker == 0, uw_risk_value == 0, Issue.age >= 55 & Issue.age <= 64, Policy.type == "SPWL")

M_NS_LR_65plus_SPWL <- final_inforce %>%
  filter(male == 1, smoker == 0, uw_risk_value == 0, Issue.age >= 65, Policy.type == "SPWL")

# Male, smoker, low risk, SPWL
M_S_LR_25to54_SPWL <- final_inforce %>%
  filter(male == 1, smoker == 1, uw_risk_value == 0, Issue.age >= 25 & Issue.age <= 54, Policy.type == "SPWL")

M_S_LR_55to64_SPWL <- final_inforce %>%
  filter(male == 1, smoker == 1, uw_risk_value == 0, Issue.age >= 55 & Issue.age <= 64, Policy.type == "SPWL")

M_S_LR_65plus_SPWL <- final_inforce %>%
  filter(male == 1, smoker == 1, uw_risk_value == 0, Issue.age >= 65, Policy.type == "SPWL")

# Male, non-smoker, high risk, SPWL
M_NS_HR_25to54_SPWL <- final_inforce %>%
  filter(male == 1, smoker == 0, uw_risk_value == 1, Issue.age >= 25 & Issue.age <= 54, Policy.type == "SPWL")

M_NS_HR_55to64_SPWL <- final_inforce %>%
  filter(male == 1, smoker == 0, uw_risk_value == 1, Issue.age >= 55 & Issue.age <= 64, Policy.type == "SPWL")

M_NS_HR_65plus_SPWL <- final_inforce %>%
  filter(male == 1, smoker == 0, uw_risk_value == 1, Issue.age >= 65, Policy.type == "SPWL")

# Male, smoker, high risk, SPWL
M_S_HR_25to54_SPWL <- final_inforce %>%
  filter(male == 1, smoker == 1, uw_risk_value == 1, Issue.age >= 25 & Issue.age <= 54, Policy.type == "SPWL")

M_S_HR_55to64_SPWL <- final_inforce %>%
  filter(male == 1, smoker == 1, uw_risk_value == 1, Issue.age >= 55 & Issue.age <= 64, Policy.type == "SPWL")

M_S_HR_65plus_SPWL <- final_inforce %>%
  filter(male == 1, smoker == 1, uw_risk_value == 1, Issue.age >= 65, Policy.type == "SPWL")

# Male, non-smoker, low risk, T20
M_NS_LR_25to54_T20 <- final_inforce %>%
  filter(male == 1, smoker == 0, uw_risk_value == 0, Issue.age >= 25 & Issue.age <= 54, Policy.type == "T20")

M_NS_LR_55to64_T20 <- final_inforce %>%
  filter(male == 1, smoker == 0, uw_risk_value == 0, Issue.age >= 55 & Issue.age <= 64, Policy.type == "T20")

M_NS_LR_65plus_T20 <- final_inforce %>%
  filter(male == 1, smoker == 0, uw_risk_value == 0, Issue.age >= 65, Policy.type == "T20")

# Male, smoker, low risk, T20
M_S_LR_25to54_T20 <- final_inforce %>%
  filter(male == 1, smoker == 1, uw_risk_value == 0, Issue.age >= 25 & Issue.age <= 54, Policy.type == "T20")

M_S_LR_55to64_T20 <- final_inforce %>%
  filter(male == 1, smoker == 1, uw_risk_value == 0, Issue.age >= 55 & Issue.age <= 64, Policy.type == "T20")

M_S_LR_65plus_T20 <- final_inforce %>%
  filter(male == 1, smoker == 1, uw_risk_value == 0, Issue.age >= 65, Policy.type == "T20")

# Male, non-smoker, high risk, T20
M_NS_HR_25to54_T20 <- final_inforce %>%
  filter(male == 1, smoker == 0, uw_risk_value == 1, Issue.age >= 25 & Issue.age <= 54, Policy.type == "T20")

M_NS_HR_55to64_T20 <- final_inforce %>%
  filter(male == 1, smoker == 0, uw_risk_value == 1, Issue.age >= 55 & Issue.age <= 64, Policy.type == "T20")

M_NS_HR_65plus_T20 <- final_inforce %>%
  filter(male == 1, smoker == 0, uw_risk_value == 1, Issue.age >= 65, Policy.type == "T20")

# Male, smoker, high risk, T20
M_S_HR_25to54_T20 <- final_inforce %>%
  filter(male == 1, smoker == 1, uw_risk_value == 1, Issue.age >= 25 & Issue.age <= 54, Policy.type == "T20")

M_S_HR_55to64_T20 <- final_inforce %>%
  filter(male == 1, smoker == 1, uw_risk_value == 1, Issue.age >= 55 & Issue.age <= 64, Policy.type == "T20")

M_S_HR_65plus_T20 <- final_inforce %>%
  filter(male == 1, smoker == 1, uw_risk_value == 1, Issue.age >= 65, Policy.type == "T20")

# Female, non-smoker, low risk, SPWL
F_NS_LR_25to54_SPWL <- final_inforce %>%
  filter(male == 0, smoker == 0, uw_risk_value == 0, Issue.age >= 25 & Issue.age <= 54, Policy.type == "SPWL")

F_NS_LR_55to64_SPWL <- final_inforce %>%
  filter(male == 0, smoker == 0, uw_risk_value == 0, Issue.age >= 55 & Issue.age <= 64, Policy.type == "SPWL")

F_NS_LR_65plus_SPWL <- final_inforce %>%
  filter(male == 0, smoker == 0, uw_risk_value == 0, Issue.age >= 65, Policy.type == "SPWL")

# Female, smoker, low risk, SPWL
F_S_LR_25to54_SPWL <- final_inforce %>%
  filter(male == 0, smoker == 1, uw_risk_value == 0, Issue.age >= 25 & Issue.age <= 54, Policy.type == "SPWL")

F_S_LR_55to64_SPWL <- final_inforce %>%
  filter(male == 0, smoker == 1, uw_risk_value == 0, Issue.age >= 55 & Issue.age <= 64, Policy.type == "SPWL")

F_S_LR_65plus_SPWL <- final_inforce %>%
  filter(male == 0, smoker == 1, uw_risk_value == 0, Issue.age >= 65, Policy.type == "SPWL")

# Female, non-smoker, high risk, SPWL
F_NS_HR_25to54_SPWL <- final_inforce %>%
  filter(male == 0, smoker == 0, uw_risk_value == 1, Issue.age >= 25 & Issue.age <= 54, Policy.type == "SPWL")

F_NS_HR_55to64_SPWL <- final_inforce %>%
  filter(male == 0, smoker == 0, uw_risk_value == 1, Issue.age >= 55 & Issue.age <= 64, Policy.type == "SPWL")

F_NS_HR_65plus_SPWL <- final_inforce %>%
  filter(male == 0, smoker == 0, uw_risk_value == 1, Issue.age >= 65, Policy.type == "SPWL")

# Female, smoker, high risk, SPWL
F_S_HR_25to54_SPWL <- final_inforce %>%
  filter(male == 0, smoker == 1, uw_risk_value == 1, Issue.age >= 25 & Issue.age <= 54, Policy.type == "SPWL")

F_S_HR_55to64_SPWL <- final_inforce %>%
  filter(male == 0, smoker == 1, uw_risk_value == 1, Issue.age >= 55 & Issue.age <= 64, Policy.type == "SPWL")

F_S_HR_65plus_SPWL <- final_inforce %>%
  filter(male == 0, smoker == 1, uw_risk_value == 1, Issue.age >= 65, Policy.type == "SPWL")

# Female, non-smoker, low risk, T20
F_NS_LR_25to54_T20 <- final_inforce %>%
  filter(male == 0, smoker == 0, uw_risk_value == 0, Issue.age >= 25 & Issue.age <= 54, Policy.type == "T20")

F_NS_LR_55to64_T20 <- final_inforce %>%
  filter(male == 0, smoker == 0, uw_risk_value == 0, Issue.age >= 55 & Issue.age <= 64, Policy.type == "T20")

F_NS_LR_65plus_T20 <- final_inforce %>%
  filter(male == 0, smoker == 0, uw_risk_value == 0, Issue.age >= 65, Policy.type == "T20")

# Female, smoker, low risk, T20
F_S_LR_25to54_T20 <- final_inforce %>%
  filter(male == 0, smoker == 1, uw_risk_value == 0, Issue.age >= 25 & Issue.age <= 54, Policy.type == "T20")

F_S_LR_55to64_T20 <- final_inforce %>%
  filter(male == 0, smoker == 1, uw_risk_value == 0, Issue.age >= 55 & Issue.age <= 64, Policy.type == "T20")

F_S_LR_65plus_T20 <- final_inforce %>%
  filter(male == 0, smoker == 1, uw_risk_value == 0, Issue.age >= 65, Policy.type == "T20")

# Female, non-smoker, high risk, T20
F_NS_HR_25to54_T20 <- final_inforce %>%
  filter(male == 0, smoker == 0, uw_risk_value == 1, Issue.age >= 25 & Issue.age <= 54, Policy.type == "T20")

F_NS_HR_55to64_T20 <- final_inforce %>%
  filter(male == 0, smoker == 0, uw_risk_value == 1, Issue.age >= 55 & Issue.age <= 64, Policy.type == "T20")

F_NS_HR_65plus_T20 <- final_inforce %>%
  filter(male == 0, smoker == 0, uw_risk_value == 1, Issue.age >= 65, Policy.type == "T20")

# Female, smoker, high risk, T20
F_S_HR_25to54_T20 <- final_inforce %>%
  filter(male == 0, smoker == 1, uw_risk_value == 1, Issue.age >= 25 & Issue.age <= 54, Policy.type == "T20")

F_S_HR_55to64_T20 <- final_inforce %>%
  filter(male == 0, smoker == 1, uw_risk_value == 1, Issue.age >= 55 & Issue.age <= 64, Policy.type == "T20")

F_S_HR_65plus_T20 <- final_inforce %>%
  filter(male == 0, smoker == 1, uw_risk_value == 1, Issue.age >= 65, Policy.type == "T20")

```

# Create Mortality Rate Data Frames and Convert to Numeric
```{r}
# Male, non-smoker, low risk
mortality_M_NS_LR <- mortality_table %>%
   select(Male_NS_LR)

mortality_M_NS_LR$Male_NS_LR <- as.numeric(mortality_M_NS_LR$Male_NS_LR)

# Male, non-smoker, high risk
mortality_M_NS_HR <- mortality_table %>%
   select(Male_NS_HR)

mortality_M_NS_HR$Male_NS_HR <- as.numeric(mortality_M_NS_HR$Male_NS_HR)

# Male, smoker, low risk
mortality_M_S_LR <- mortality_table %>%
   select(Male_S_LR)

mortality_M_S_LR$Male_S_LR <- as.numeric(mortality_M_S_LR$Male_S_LR)

# Male, smoker, high risk
mortality_M_S_HR <- mortality_table %>%
   select(Male_S_HR)

mortality_M_S_HR$Male_S_HR <- as.numeric(mortality_M_S_HR$Male_S_HR)

# Female, non-smoker, low risk
mortality_F_NS_LR <- mortality_table %>%
   select(Female_NS_LR)

mortality_F_NS_LR$Female_NS_LR <- as.numeric(mortality_F_NS_LR$Female_NS_LR)

# Female, non-smoker, high risk
mortality_F_NS_HR <- mortality_table %>%
   select(Female_NS_HR)

mortality_F_NS_HR$Female_NS_HR <- as.numeric(mortality_F_NS_HR$Female_NS_HR)

# Female, smoker, low risk
mortality_F_S_LR <- mortality_table %>%
   select(Female_S_LR)

mortality_F_S_LR$Female_S_LR <- as.numeric(mortality_F_S_LR$Female_S_LR)

# Female, smoker, high risk
mortality_F_S_HR <- mortality_table %>%
   select(Female_S_HR)

mortality_F_S_HR$Female_S_HR <- as.numeric(mortality_F_S_HR$Female_S_HR)


```

# Premium Calculation - SPWL

```{r, warning=FALSE}
# Function to calculate premium for a single premium whole life policy without cash value
calculate_premium_equivalence_spwl <- function(age, mortality_rate, death_benefit) {

  # Calculate the present value of death benefit
  present_value_death_benefit <- death_benefit / ((1 + 0.059) ^ age)
  
  # Calculate premium using equivalence principle
  premium <- present_value_death_benefit * (1 + mortality_rate)
  return(premium)
}

# Initialize a list to store premiums for each group
spwl_premiums_list <- list()
```

## Male, non-smoker, low risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_NS_LR_25to54_SPWL", "M_NS_LR_55to64_SPWL", "M_NS_LR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_M_NS_LR$Male_NS_LR[age]
    
    premiums[i] <- calculate_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  spwl_premiums_list[[group]] <- premiums
}
```

## Male, non-smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_NS_HR_25to54_SPWL", "M_NS_HR_55to64_SPWL", "M_NS_HR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_M_NS_HR$Male_NS_HR[age]
    
    premiums[i] <- calculate_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  spwl_premiums_list[[group]] <- premiums
}
```

## Male, smoker, low risk - 0 observations = no premiums
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_S_LR_25to54_SPWL", "M_S_LR_55to64_SPWL", "M_S_LR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_M_S_LR$Male_S_LR[age]
    
    premiums[i] <- calculate_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  spwl_premiums_list[[group]] <- premiums
}
```

## Male, smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_S_HR_25to54_SPWL", "M_S_HR_55to64_SPWL", "M_S_HR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_M_S_HR$Male_S_HR[age]
    
    premiums[i] <- calculate_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  spwl_premiums_list[[group]] <- premiums
}
```

## Female, non-smoker, low risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("F_NS_LR_25to54_SPWL", "F_NS_LR_55to64_SPWL", "F_NS_LR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_F_NS_LR$Female_NS_LR[age]
    
    premiums[i] <- calculate_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  spwl_premiums_list[[group]] <- premiums
}
```

## Female, non-smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("F_NS_HR_25to54_SPWL", "F_NS_HR_55to64_SPWL", "F_NS_HR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_F_NS_HR$Female_NS_HR[age]
    
    premiums[i] <- calculate_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  spwl_premiums_list[[group]] <- premiums
}
```

## Female, smoker, low risk - 0 observations = no premiums
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("F_S_LR_25to54_SPWL", "F_S_LR_55to64_SPWL", "F_S_LR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_F_S_LR$Female_S_LR[age]
    
    premiums[i] <- calculate_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  spwl_premiums_list[[group]] <- premiums
}
```

## Female, smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("F_S_HR_25to54_SPWL", "F_S_HR_55to64_SPWL", "F_S_HR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_F_S_HR$Female_S_HR[age]
    
    premiums[i] <- calculate_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  spwl_premiums_list[[group]] <- premiums
}
```

# Premium Calculation - 20-year Term Life Monthly Premium

```{r, warning = FALSE}
# Function to calculate premium for a 20-year term life policy paid monthly
calculate_t20_premium <- function(mortality_rate, benefit, age) {

mthly_interest <- (1.059)^(1/12) - 1

# Calculate present value of expected future benefits
pv_benefit <- (benefit * mortality_rate) / ((1 + mthly_interest)^(12*20))

# Calculate present value of an annuity due using the formula: PV = Pmt * [1 - (1 + r)^(-n)] / r
# where PV is the present value, Pmt is the annuity payment, r is the discount rate, and n is the number of periods
#monthly_premium <- pv_benefit / (((1 - (1 + mthly_interest)^(-20 * 12))) / (mthly_interest / (1 + mthly_interest)))

monthly_premium <- pv_benefit * (1 / (1 + mthly_interest)) * (mthly_interest / (1 - (1 + mthly_interest)^(-20*12)))

# Display result
return(monthly_premium * 12)

}

# Initialize a list to store premiums for each group
t20_premiums_list <- list()
```


## Male, non-smoker, low risk
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("M_NS_LR_25to54_T20", "M_NS_LR_55to64_T20", "M_NS_LR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_M_NS_LR$Male_NS_LR[age]
    
    premiums[i] <- calculate_t20_premium(mortality_rate, death_benefit, age)
  }
  t20_premiums_list[[group]] <- premiums
}
```

## Male, non-smoker, high risk
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("M_NS_HR_25to54_T20", "M_NS_HR_55to64_T20", "M_NS_HR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_M_NS_HR$Male_NS_HR[age]
    
    premiums[i] <- calculate_t20_premium(mortality_rate, death_benefit, age)
  }
  t20_premiums_list[[group]] <- premiums
}
```

## Male, smoker, low risk - 0 observations = 0 premiums
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("M_S_LR_25to54_T20", "M_S_LR_55to64_T20", "M_S_LR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_M_S_LR$Male_S_LR[age]
    
    premiums[i] <- calculate_t20_premium(mortality_rate, death_benefit, age)
  }
  t20_premiums_list[[group]] <- premiums
}
```

## Male, smoker, high risk
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("M_S_HR_25to54_T20", "M_S_HR_55to64_T20", "M_S_HR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_M_S_HR$Male_S_HR[age]
    
    premiums[i] <- calculate_t20_premium(mortality_rate, death_benefit, age)
  }
  t20_premiums_list[[group]] <- premiums
}
```

## Female, non-smoker, low risk
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("F_NS_LR_25to54_T20", "F_NS_LR_55to64_T20", "F_NS_LR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_F_NS_LR$Female_NS_LR[age]
    
    premiums[i] <- calculate_t20_premium(mortality_rate, death_benefit, age)
  }
  t20_premiums_list[[group]] <- premiums
}
```

## Female, non-smoker, high risk
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("F_NS_HR_25to54_T20", "F_NS_HR_55to64_T20", "F_NS_HR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_F_NS_HR$Female_NS_HR[age]
    
    premiums[i] <- calculate_t20_premium(mortality_rate, death_benefit, age)
  }
  t20_premiums_list[[group]] <- premiums
}
```

## Female, smoker, low risk - 0 observations = 0 premiums
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("F_S_LR_25to54_T20", "F_S_LR_55to64_T20", "F_S_LR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_F_S_LR$Female_S_LR[age]
    
    premiums[i] <- calculate_t20_premium(mortality_rate, death_benefit, age)
  }
  t20_premiums_list[[group]] <- premiums
}
```

## Female, smoker, high risk
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("F_S_HR_25to54_T20", "F_S_HR_55to64_T20", "F_S_HR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- mortality_F_S_HR$Female_S_HR[age]
    
    premiums[i] <- calculate_t20_premium(mortality_rate, death_benefit, age)
  }
  t20_premiums_list[[group]] <- premiums
}
```

# Mortality Tables with Incentives

Physical - Fitness Tracking Incentive - 4.5% reduction in mortality
Mental - Mental Health Support Incentive - 5.5% reduction in mortality

Smokers Only - Smoking Cessation Program - 25% reduction in mortality

```{r}
# Male, non-smoker, low risk
adj_mort_M_NS_LR <- mortality_M_NS_LR %>%
  mutate(adj_Male_NS_LR = Male_NS_LR * (1-0.045) * (1-0.055))

adj_mort_M_NS_LR$adj_Male_NS_LR <- as.numeric(adj_mort_M_NS_LR$adj_Male_NS_LR)

# Male, non-smoker, high risk
adj_mort_M_NS_HR <- mortality_M_NS_HR %>%
  mutate(adj_Male_NS_HR = Male_NS_HR * (1-0.045) * (1-0.055))

adj_mort_M_NS_HR$adj_Male_NS_HR <- as.numeric(adj_mort_M_NS_HR$adj_Male_NS_HR)

# Male, smoker, low risk
adj_mort_M_S_LR <- mortality_M_S_LR %>%
  mutate(adj_Male_S_LR = Male_S_LR * (1-0.045) * (1-0.055) * (1-0.25))

adj_mort_M_S_LR$adj_Male_S_LR <- as.numeric(adj_mort_M_S_LR$adj_Male_S_LR)

# Male, smoker, high risk
adj_mort_M_S_HR <- mortality_M_S_HR %>%
  mutate(adj_Male_S_HR = Male_S_HR * (1-0.045) * (1-0.055) * (1-0.25))

adj_mort_M_S_HR$adj_Male_S_HR <- as.numeric(adj_mort_M_S_HR$adj_Male_S_HR)


# Female, non-smoker, low risk
adj_mort_F_NS_LR <- mortality_F_NS_LR %>%
  mutate(adj_Female_NS_LR = Female_NS_LR * (1-0.045) * (1-0.055))

adj_mort_F_NS_LR$adj_Female_NS_LR <- as.numeric(adj_mort_F_NS_LR$adj_Female_NS_LR)


# Female, non-smoker, high risk
adj_mort_F_NS_HR <- mortality_F_NS_HR %>%
  mutate(adj_Female_NS_HR = Female_NS_HR * (1-0.045) * (1-0.055))

adj_mort_F_NS_HR$adj_Female_NS_HR <- as.numeric(adj_mort_F_NS_HR$adj_Female_NS_HR)

# Female, smoker, low risk
adj_mort_F_S_LR <- mortality_F_S_LR %>%
  mutate(adj_Female_S_LR = Female_S_LR * (1-0.045) * (1-0.055) * (1-0.25))

adj_mort_F_S_LR$adj_Female_S_LR <- as.numeric(adj_mort_F_S_LR$adj_Female_S_LR)


# Female, smoker, high risk
adj_mort_F_S_HR <- mortality_F_S_HR %>%
  mutate(adj_Female_S_HR = Female_S_HR * (1-0.045) * (1-0.055) * (1-0.25))

adj_mort_F_S_HR$adj_Female_S_HR <- as.numeric(adj_mort_F_S_HR$adj_Female_S_HR)

```

# Premium Calculation with Health Incentives - SPWL

```{r, warning=FALSE}
# Function to calculate premium for a single premium whole life policy without cash value
calculate_int_premium_equivalence_spwl <- function(age, mortality_rate, death_benefit) {

  # Calculate the present value of death benefit
  present_value_death_benefit <- death_benefit / ((1 + 0.059) ^ age)
  
  # Calculate premium using equivalence principle
  premium <- present_value_death_benefit * (1 + mortality_rate)
  return(premium)
}

# Initialize a list to store premiums for each group
incentives_spwl_premiums <- list()
```

## Male, non-smoker, low risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_NS_LR_25to54_SPWL", "M_NS_LR_55to64_SPWL", "M_NS_LR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_M_NS_LR$adj_Male_NS_LR[age]
    
    premiums[i] <- calculate_int_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  incentives_spwl_premiums[[group]] <- premiums
}
```

## Male, non-smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_NS_HR_25to54_SPWL", "M_NS_HR_55to64_SPWL", "M_NS_HR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_M_NS_HR$adj_Male_NS_HR[age]
    
    premiums[i] <- calculate_int_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  incentives_spwl_premiums[[group]] <- premiums
}
```

## Male, smoker, low risk - 0 observations = no premiums
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_S_LR_25to54_SPWL", "M_S_LR_55to64_SPWL", "M_S_LR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_M_S_LR$adj_Male_S_LR[age]
    
    premiums[i] <- calculate_int_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  incentives_spwl_premiums[[group]] <- premiums
}
```

## Male, smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_S_HR_25to54_SPWL", "M_S_HR_55to64_SPWL", "M_S_HR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_M_S_HR$adj_Male_S_HR[age]
    
    premiums[i] <- calculate_int_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  incentives_spwl_premiums[[group]] <- premiums
}
```

## Female, non-smoker, low risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("F_NS_LR_25to54_SPWL", "F_NS_LR_55to64_SPWL", "F_NS_LR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_F_NS_LR$adj_Female_NS_LR[age]
    
    premiums[i] <- calculate_int_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  incentives_spwl_premiums[[group]] <- premiums
}
```

## Female, non-smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("F_NS_HR_25to54_SPWL", "F_NS_HR_55to64_SPWL", "F_NS_HR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_F_NS_HR$adj_Female_NS_HR[age]
    
    premiums[i] <- calculate_int_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  incentives_spwl_premiums[[group]] <- premiums
}
```

## Female, smoker, low risk - 0 observations = no premiums
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("F_S_LR_25to54_SPWL", "F_S_LR_55to64_SPWL", "F_S_LR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_F_S_LR$adj_Female_S_LR[age]
    
    premiums[i] <- calculate_int_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  incentives_spwl_premiums[[group]] <- premiums
}
```

## Female, smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("F_S_HR_25to54_SPWL", "F_S_HR_55to64_SPWL", "F_S_HR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_F_S_HR$adj_Female_S_HR[age]
    
    premiums[i] <- calculate_int_premium_equivalence_spwl(age, mortality_rate, death_benefit)
  }
  
  incentives_spwl_premiums[[group]] <- premiums
}
```

```{r}
# Combine the two lists using the list() function
combined_spwl_premiums <- list(incentives_spwl_premiums, spwl_premiums_list)

# Function to calculate the average of corresponding elements in two lists
average_lists <- function(list1, list2) {
  return((list1 + list2) / 2)
}

# Apply the function to each pair of lists in the 3D list
result <- lapply(seq_along(combined_spwl_premiums[[1]]), function(i) {
  average_lists(combined_spwl_premiums[[1]][[i]], combined_spwl_premiums[[2]][[i]])
})

# Convert the result back to a 2D list
spwl_middle_premiums <- do.call(cbind, result)

colnames(spwl_middle_premiums) <- c("M_NS_LR_25to54", "M_NS_LR_55to64", "M_NS_LR_65plus",
                               "M_NS_HR_25to54", "M_NS_HR_55to64", "M_NS_HR_65plus",
                               "M_S_LR_25to54", "M_S_LR_55to64", "M_S_LR_65plus",
                               "M_S_HR_25to54", "M_S_HR_55to64", "M_S_HR_65plus",
                               "F_NS_LR_25to54", "F_NS_LR_55to64", "F_NS_LR_65plus",
                                "F_NS_HR_25to54", "F_NS_HR_55to64", "F_NS_HR_65plus",
                                "F_S_LR_25to54", "F_S_LR_55to64", "F_S_LR_65plus",
                                "F_S_HR_25to54", "F_S_HR_55to64", "F_S_HR_65plus")

spwl_middle_premiums <- data.frame(spwl_middle_premiums)

write_xlsx(spwl_middle_premiums, "~/Desktop/spwl_middle_premiums.xlsx")

```

```{r}
# Combine the two lists using the list() function
combined_spwl_premiums <- list(incentives_spwl_premiums, spwl_premiums_list)

# Function to calculate the difference of corresponding elements in two lists
diff_lists <- function(list1, list2) {
  return(abs(list1 - list2))
}

# Apply the function to each pair of lists in the 3D list
result <- lapply(seq_along(combined_spwl_premiums[[1]]), function(i) {
  diff_lists(combined_spwl_premiums[[1]][[i]], combined_spwl_premiums[[2]][[i]])
})

# Convert the result back to a 2D list
diff_premiums <- do.call(cbind, result)

colnames(diff_premiums) <- c("M_NS_LR_25to54", "M_NS_LR_55to64", "M_NS_LR_65plus",
                               "M_NS_HR_25to54", "M_NS_HR_55to64", "M_NS_HR_65plus",
                               "M_S_LR_25to54", "M_S_LR_55to64", "M_S_LR_65plus",
                               "M_S_HR_25to54", "M_S_HR_55to64", "M_S_HR_65plus",
                               "F_NS_LR_25to54", "F_NS_LR_55to64", "F_NS_LR_65plus",
                                "F_NS_HR_25to54", "F_NS_HR_55to64", "F_NS_HR_65plus",
                                "F_S_LR_25to54", "F_S_LR_55to64", "F_S_LR_65plus",
                                "F_S_HR_25to54", "F_S_HR_55to64", "F_S_HR_65plus")

diff_premiums <- data.frame(diff_premiums)

factor <- (1 + 0.059)^23

spwl_diff_premiums <- diff_premiums * factor


```


# Premiums Calculation with Health Incentives - 20-year Term Life

```{r, warning = FALSE}
# Function to calculate premium for a 20-year term life policy paid monthly
calculate_int_t20_premium <- function(mortality_rate, benefit, age) {

mthly_interest <- (1.059)^(1/12) - 1

# Calculate present value of expected future benefits
pv_benefit <- (benefit * mortality_rate) / ((1 + mthly_interest)^(12*20))

# Calculate present value of an annuity due using the formula: PV = Pmt * [1 - (1 + r)^(-n)] / r
# where PV is the present value, Pmt is the annuity payment, r is the discount rate, and n is the number of periods
#monthly_premium <- pv_benefit / (((1 - (1 + mthly_interest)^(-20 * 12))) / (mthly_interest / (1 + mthly_interest)))

monthly_premium <- pv_benefit * (1 / (1 + mthly_interest)) * (mthly_interest / (1 - (1 + mthly_interest)^(-20*12)))

# Display result
return(monthly_premium * 12)

}

# Initialize a list to store premiums for each group
incentives_t20_premiums <- list()
```

## Male, non-smoker, low risk
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("M_NS_LR_25to54_T20", "M_NS_LR_55to64_T20", "M_NS_LR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_M_NS_LR$adj_Male_NS_LR[age]
    
    premiums[i] <- calculate_int_t20_premium(mortality_rate, death_benefit, age)
  }
  incentives_t20_premiums[[group]] <- premiums
}
```

## Male, non-smoker, high risk
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("M_NS_HR_25to54_T20", "M_NS_HR_55to64_T20", "M_NS_HR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_M_NS_HR$adj_Male_NS_HR[age]
    
    premiums[i] <- calculate_int_t20_premium(mortality_rate, death_benefit, age)
  }
  incentives_t20_premiums[[group]] <- premiums
}
```

## Male, smoker, low risk - 0 observations = 0 premiums
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("M_S_LR_25to54_T20", "M_S_LR_55to64_T20", "M_S_LR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_M_S_LR$adj_Male_S_LR[age]
    
    premiums[i] <- calculate_int_t20_premium(mortality_rate, death_benefit, age)
  }
  incentives_t20_premiums[[group]] <- premiums
}
```

## Male, smoker, high risk
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("M_S_HR_25to54_T20", "M_S_HR_55to64_T20", "M_S_HR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_M_S_HR$adj_Male_S_HR[age]
    
    premiums[i] <- calculate_int_t20_premium(mortality_rate, death_benefit, age)
  }
  incentives_t20_premiums[[group]] <- premiums
}
```

## Female, non-smoker, low risk
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("F_NS_LR_25to54_T20", "F_NS_LR_55to64_T20", "F_NS_LR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_F_NS_LR$adj_Female_NS_LR[age]
    
    premiums[i] <- calculate_int_t20_premium(mortality_rate, death_benefit, age)
  }
  incentives_t20_premiums[[group]] <- premiums
}
```

## Female, non-smoker, high risk
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("F_NS_HR_25to54_T20", "F_NS_HR_55to64_T20", "F_NS_HR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_F_NS_HR$adj_Female_NS_HR[age]
    
    premiums[i] <- calculate_int_t20_premium(mortality_rate, death_benefit, age)
  }
  incentives_t20_premiums[[group]] <- premiums
}
```

## Female, smoker, low risk - 0 observations = 0 premiums
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("F_S_LR_25to54_T20", "F_S_LR_55to64_T20", "F_S_LR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_F_S_LR$adj_Female_S_LR[age]
    
    premiums[i] <- calculate_int_t20_premium(mortality_rate, death_benefit, age)
  }
  incentives_t20_premiums[[group]] <- premiums
}
```

## Female, smoker, high risk
```{r, warning=FALSE}
# Define groups for T20 policies
groups_t20 <- c("F_S_HR_25to54_T20", "F_S_HR_55to64_T20", "F_S_HR_65plus_T20")

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    premiums <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    mortality_rate <- adj_mort_F_S_HR$adj_Female_S_HR[age]
    
    premiums[i] <- calculate_int_t20_premium(mortality_rate, death_benefit, age)
  }
  incentives_t20_premiums[[group]] <- premiums
}
```

```{r, warning=FALSE}
# Combine the two lists using the list() function
combined_t20_premiums <- list(incentives_t20_premiums, t20_premiums_list)

# Function to calculate the average of corresponding elements in two lists
average_lists <- function(list1, list2) {
  return((list1 + list2) / 2)
}

# Apply the function to each pair of lists in the 3D list
result <- lapply(seq_along(combined_t20_premiums[[1]]), function(i) {
  average_lists(combined_t20_premiums[[1]][[i]], combined_t20_premiums[[2]][[i]])
})

# Convert the result back to a 2D list
t20_middle_premiums <- do.call(cbind, result)

colnames(t20_middle_premiums) <- c("M_NS_LR_25to54", "M_NS_LR_55to64", "M_NS_LR_65plus",
                               "M_NS_HR_25to54", "M_NS_HR_55to64", "M_NS_HR_65plus",
                               "M_S_LR_25to54", "M_S_LR_55to64", "M_S_LR_65plus",
                               "M_S_HR_25to54", "M_S_HR_55to64", "M_S_HR_65plus",
                               "F_NS_LR_25to54", "F_NS_LR_55to64", "F_NS_LR_65plus",
                                "F_NS_HR_25to54", "F_NS_HR_55to64", "F_NS_HR_65plus",
                                "F_S_LR_25to54", "F_S_LR_55to64", "F_S_LR_65plus",
                                "F_S_HR_25to54", "F_S_HR_55to64", "F_S_HR_65plus")

t20_middle_premiums <- data.frame(t20_middle_premiums)

write_xlsx(t20_middle_premiums, "~/Desktop/t20_middle_premiums.xlsx")

```

```{r, warning=FALSE}
# Combine the two lists using the list() function
combined_t20_premiums <- list(incentives_t20_premiums, t20_premiums_list)

# Function to calculate the difference of corresponding elements in two lists
average_lists <- function(list1, list2) {
  return(abs(list1 - list2))
}

# Apply the function to each pair of lists in the 3D list
result <- lapply(seq_along(combined_t20_premiums[[1]]), function(i) {
  average_lists(combined_t20_premiums[[1]][[i]], combined_t20_premiums[[2]][[i]])
})

# Convert the result back to a 2D list
t20_diff_premiums <- do.call(cbind, result)

colnames(t20_diff_premiums) <- c("M_NS_LR_25to54", "M_NS_LR_55to64", "M_NS_LR_65plus",
                               "M_NS_HR_25to54", "M_NS_HR_55to64", "M_NS_HR_65plus",
                               "M_S_LR_25to54", "M_S_LR_55to64", "M_S_LR_65plus",
                               "M_S_HR_25to54", "M_S_HR_55to64", "M_S_HR_65plus",
                               "F_NS_LR_25to54", "F_NS_LR_55to64", "F_NS_LR_65plus",
                                "F_NS_HR_25to54", "F_NS_HR_55to64", "F_NS_HR_65plus",
                                "F_S_LR_25to54", "F_S_LR_55to64", "F_S_LR_65plus",
                                "F_S_HR_25to54", "F_S_HR_55to64", "F_S_HR_65plus")

t20_diff_premiums <- data.frame(t20_diff_premiums)

factor <- (1.059)^23

t20_diff_premiums <- t20_diff_premiums * factor

```


# Calculating EPV of Benefits - SPWL

```{r}
# Function to calculate actuarial present value A_x for each age and each column in a mortality table with multiple rates
calculate_ax_for_all_ages_and_columns <- function(mortality_df, discount_rate) {
  ax_values <- matrix(NA, nrow = nrow(mortality_df), ncol = ncol(mortality_df) - 1)  # Exclude the first column (age)
  
  for (j in 2:ncol(mortality_df)) {
    for (i in 1:nrow(mortality_df)) {
      ax_values[i, j-1] <- sum((1 / (1 + discount_rate))^seq(0, nrow(mortality_df)-1) * mortality_df[i, j])
    }
  }
  
  colnames(ax_values) <- colnames(mortality_df)[-1]  # Set column names based on rate groups
  rownames(ax_values) <- mortality_df$Age  # Set row names based on ages
  
  return(ax_values)
}

interest_rate <- 0.059

mortality_table2 <- as.data.frame(sapply(mortality_table, as.numeric))

# Then, you can calculate the actuarial present value A_x for each age and each column as:
Ax_values <- data.frame(calculate_ax_for_all_ages_and_columns(mortality_table2, interest_rate))

```


```{r, warning=FALSE}
# Function to calculate premium for a single premium whole life policy without cash value
calculate_epv_benefit_spwl <- function(age, face_amount, Ax) {

  # Calculate EPV of benefit for specified age using Ax
  epv_benefit <- face_amount * Ax
  
  return(epv_benefit)
}

# Initialize a list to store premiums for each group
spwl_epv_benefits <- list()
```

## Male, non-smoker, low risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_NS_LR_25to54_SPWL", "M_NS_LR_55to64_SPWL", "M_NS_LR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Male_NS_LR[age]
    
    benefits[i] <- calculate_epv_benefit_spwl(age, death_benefit, value_Ax)
  }
  
  spwl_epv_benefits[[group]] <- benefits
}
```

## Male, non-smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_NS_HR_25to54_SPWL", "M_NS_HR_55to64_SPWL", "M_NS_HR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Male_NS_HR[age]
    
    benefits[i] <- calculate_epv_benefit_spwl(age, death_benefit, value_Ax)
  }
  
  spwl_epv_benefits[[group]] <- benefits
}
```

## Male, smoker, low risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_S_LR_25to54_SPWL", "M_S_LR_55to64_SPWL", "M_S_LR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Male_S_LR[age]
    
    benefits[i] <- calculate_epv_benefit_spwl(age, death_benefit, value_Ax)
  }
  
  spwl_epv_benefits[[group]] <- benefits
}
```

## Male, smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_S_HR_25to54_SPWL", "M_S_HR_55to64_SPWL", "M_S_HR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Male_S_HR[age]
    
    benefits[i] <- calculate_epv_benefit_spwl(age, death_benefit, value_Ax)
  }
  
  spwl_epv_benefits[[group]] <- benefits
}
```

## Female, non-smoker, low risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("F_NS_LR_25to54_SPWL", "F_NS_LR_55to64_SPWL", "F_NS_LR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Female_NS_LR[age]
    
    benefits[i] <- calculate_epv_benefit_spwl(age, death_benefit, value_Ax)
  }
  
  spwl_epv_benefits[[group]] <- benefits
}
```

## Female, non-smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("F_NS_HR_25to54_SPWL", "F_NS_HR_55to64_SPWL", "F_NS_HR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Female_NS_HR[age]
    
    benefits[i] <- calculate_epv_benefit_spwl(age, death_benefit, value_Ax)
  }
  
  spwl_epv_benefits[[group]] <- benefits
}
```

## Female, smoker, low risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("F_S_LR_25to54_SPWL", "F_S_LR_55to64_SPWL", "F_S_LR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Female_S_LR[age]
    
    benefits[i] <- calculate_epv_benefit_spwl(age, death_benefit, value_Ax)
  }
  
  spwl_epv_benefits[[group]] <- benefits
}
```

## Female, smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("F_S_HR_25to54_SPWL", "F_S_HR_55to64_SPWL", "F_S_HR_65plus_SPWL")

# Iterate over each group and calculate premiums
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Female_S_HR[age]
    
    benefits[i] <- calculate_epv_benefit_spwl(age, death_benefit, value_Ax)
  }
  
  spwl_epv_benefits[[group]] <- benefits
}
```

# Calculating EPV of Benefits - 20-year term

```{r, warning=FALSE}
# Function to calculate premium for a single premium whole life policy without cash value
calculate_epv_benefit_t20 <- function(age, face_amount, Ax, Ex, Ax20) {

  # Calculate EPV of benefit for specified age using Ax
  epv_benefit <- face_amount * (Ax - (Ex * Ax20))
  
  return(epv_benefit)
}

# Initialize a list to store premiums for each group
t20_epv_benefits <- list()
```

## Male, non-smoker, low risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_t20 <- c("M_NS_LR_25to54_T20", "M_NS_LR_55to64_T20", "M_NS_LR_65plus_T20")

v20 <- (1.059)^-20

temp_mort <- mortality_M_NS_LR$Male_NS_LR

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Male_NS_LR[age]
    value_Ax20 <- Ax_values$Male_NS_LR[age+20]
    value_Ex <- v20 * (1-temp_mort[age]) * (1-temp_mort[age+1]) * (1-temp_mort[age+2]) * (1-temp_mort[age+3]) * (1-temp_mort[age+4]) *     (1-temp_mort[age+5]) * (1-temp_mort[age+6]) * (1-temp_mort[age+7]) * (1-temp_mort[age+8]) * (1-temp_mort[age+9]) * (1-temp_mort[age+10]) * (1-temp_mort[age+11]) * (1-temp_mort[age+12]) * (1-temp_mort[age+13]) * (1-temp_mort[age+14]) * (1-temp_mort[age+15]) * (1-temp_mort[age+16]) * (1-temp_mort[age+17]) * (1-temp_mort[age+18]) * (1-temp_mort[age+19])
    
    benefits[i] <- calculate_epv_benefit_t20(age, death_benefit, value_Ax, value_Ex, value_Ax20)
  }
  
  t20_epv_benefits[[group]] <- benefits
}
```

## Male, non-smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_t20 <- c("M_NS_HR_25to54_T20", "M_NS_HR_55to64_T20", "M_NS_HR_65plus_T20")

v20 <- (1.059)^-20

temp_mort <- mortality_M_NS_HR$Male_NS_HR

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Male_NS_HR[age]
    value_Ax20 <- Ax_values$Male_NS_HR[age+20]
    value_Ex <- v20 * (1-temp_mort[age]) * (1-temp_mort[age+1]) * (1-temp_mort[age+2]) * (1-temp_mort[age+3]) * (1-temp_mort[age+4]) *     (1-temp_mort[age+5]) * (1-temp_mort[age+6]) * (1-temp_mort[age+7]) * (1-temp_mort[age+8]) * (1-temp_mort[age+9]) * (1-temp_mort[age+10]) * (1-temp_mort[age+11]) * (1-temp_mort[age+12]) * (1-temp_mort[age+13]) * (1-temp_mort[age+14]) * (1-temp_mort[age+15]) * (1-temp_mort[age+16]) * (1-temp_mort[age+17]) * (1-temp_mort[age+18]) * (1-temp_mort[age+19])
    
    benefits[i] <- calculate_epv_benefit_t20(age, death_benefit, value_Ax, value_Ex, value_Ax20)
  }
  
  t20_epv_benefits[[group]] <- benefits
}
```

## Male, smoker, low risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_t20 <- c("M_S_LR_25to54_T20", "M_S_LR_55to64_T20", "M_S_LR_65plus_T20")

v20 <- (1.059)^-20

temp_mort <- mortality_M_S_LR$Male_S_LR

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Male_S_LR[age]
    value_Ax20 <- Ax_values$Male_S_LR[age+20]
    value_Ex <- v20 * (1-temp_mort[age]) * (1-temp_mort[age+1]) * (1-temp_mort[age+2]) * (1-temp_mort[age+3]) * (1-temp_mort[age+4]) *     (1-temp_mort[age+5]) * (1-temp_mort[age+6]) * (1-temp_mort[age+7]) * (1-temp_mort[age+8]) * (1-temp_mort[age+9]) * (1-temp_mort[age+10]) * (1-temp_mort[age+11]) * (1-temp_mort[age+12]) * (1-temp_mort[age+13]) * (1-temp_mort[age+14]) * (1-temp_mort[age+15]) * (1-temp_mort[age+16]) * (1-temp_mort[age+17]) * (1-temp_mort[age+18]) * (1-temp_mort[age+19])
    
    benefits[i] <- calculate_epv_benefit_t20(age, death_benefit, value_Ax, value_Ex, value_Ax20)
  }
  
  t20_epv_benefits[[group]] <- benefits
}
```

## Male, smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_t20 <- c("M_S_HR_25to54_T20", "M_S_HR_55to64_T20", "M_S_HR_65plus_T20")

v20 <- (1.059)^-20

temp_mort <- mortality_M_S_HR$Male_S_HR

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Male_S_HR[age]
    value_Ax20 <- Ax_values$Male_S_HR[age+20]
    value_Ex <- v20 * (1-temp_mort[age]) * (1-temp_mort[age+1]) * (1-temp_mort[age+2]) * (1-temp_mort[age+3]) * (1-temp_mort[age+4]) *     (1-temp_mort[age+5]) * (1-temp_mort[age+6]) * (1-temp_mort[age+7]) * (1-temp_mort[age+8]) * (1-temp_mort[age+9]) * (1-temp_mort[age+10]) * (1-temp_mort[age+11]) * (1-temp_mort[age+12]) * (1-temp_mort[age+13]) * (1-temp_mort[age+14]) * (1-temp_mort[age+15]) * (1-temp_mort[age+16]) * (1-temp_mort[age+17]) * (1-temp_mort[age+18]) * (1-temp_mort[age+19])
    
    benefits[i] <- calculate_epv_benefit_t20(age, death_benefit, value_Ax, value_Ex, value_Ax20)
  }
  
  t20_epv_benefits[[group]] <- benefits
}
```

## Female, non-smoker, low risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_t20 <- c("F_NS_LR_25to54_T20", "F_NS_LR_55to64_T20", "F_NS_LR_65plus_T20")

v20 <- (1.059)^-20

temp_mort <- mortality_F_NS_LR$Female_NS_LR

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Female_NS_LR[age]
    value_Ax20 <- Ax_values$Female_NS_LR[age+20]
    value_Ex <- v20 * (1-temp_mort[age]) * (1-temp_mort[age+1]) * (1-temp_mort[age+2]) * (1-temp_mort[age+3]) * (1-temp_mort[age+4]) *     (1-temp_mort[age+5]) * (1-temp_mort[age+6]) * (1-temp_mort[age+7]) * (1-temp_mort[age+8]) * (1-temp_mort[age+9]) * (1-temp_mort[age+10]) * (1-temp_mort[age+11]) * (1-temp_mort[age+12]) * (1-temp_mort[age+13]) * (1-temp_mort[age+14]) * (1-temp_mort[age+15]) * (1-temp_mort[age+16]) * (1-temp_mort[age+17]) * (1-temp_mort[age+18]) * (1-temp_mort[age+19])
    
    benefits[i] <- calculate_epv_benefit_t20(age, death_benefit, value_Ax, value_Ex, value_Ax20)
  }
  
  t20_epv_benefits[[group]] <- benefits
}
```

## Female, non-smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_t20 <- c("F_NS_HR_25to54_T20", "F_NS_HR_55to64_T20", "F_NS_HR_65plus_T20")

v20 <- (1.059)^-20

temp_mort <- mortality_F_NS_HR$Female_NS_HR

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Female_NS_HR[age]
    value_Ax20 <- Ax_values$Female_NS_HR[age+20]
    value_Ex <- v20 * (1-temp_mort[age]) * (1-temp_mort[age+1]) * (1-temp_mort[age+2]) * (1-temp_mort[age+3]) * (1-temp_mort[age+4]) *     (1-temp_mort[age+5]) * (1-temp_mort[age+6]) * (1-temp_mort[age+7]) * (1-temp_mort[age+8]) * (1-temp_mort[age+9]) * (1-temp_mort[age+10]) * (1-temp_mort[age+11]) * (1-temp_mort[age+12]) * (1-temp_mort[age+13]) * (1-temp_mort[age+14]) * (1-temp_mort[age+15]) * (1-temp_mort[age+16]) * (1-temp_mort[age+17]) * (1-temp_mort[age+18]) * (1-temp_mort[age+19])
    
    benefits[i] <- calculate_epv_benefit_t20(age, death_benefit, value_Ax, value_Ex, value_Ax20)
  }
  
  t20_epv_benefits[[group]] <- benefits
}
```

## Female, smoker, low risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_t20 <- c("F_S_LR_25to54_T20", "F_S_LR_55to64_T20", "F_S_LR_65plus_T20")

v20 <- (1.059)^-20

temp_mort <- mortality_F_S_LR$Female_S_LR

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Female_S_LR[age]
    value_Ax20 <- Ax_values$Female_S_LR[age+20]
    value_Ex <- v20 * (1-temp_mort[age]) * (1-temp_mort[age+1]) * (1-temp_mort[age+2]) * (1-temp_mort[age+3]) * (1-temp_mort[age+4]) *     (1-temp_mort[age+5]) * (1-temp_mort[age+6]) * (1-temp_mort[age+7]) * (1-temp_mort[age+8]) * (1-temp_mort[age+9]) * (1-temp_mort[age+10]) * (1-temp_mort[age+11]) * (1-temp_mort[age+12]) * (1-temp_mort[age+13]) * (1-temp_mort[age+14]) * (1-temp_mort[age+15]) * (1-temp_mort[age+16]) * (1-temp_mort[age+17]) * (1-temp_mort[age+18]) * (1-temp_mort[age+19])
    
    benefits[i] <- calculate_epv_benefit_t20(age, death_benefit, value_Ax, value_Ex, value_Ax20)
  }
  
  t20_epv_benefits[[group]] <- benefits
}
```

## Female, smoker, high risk
```{r, warning=FALSE}
# Define groups for SPWL policies
groups_t20 <- c("F_S_HR_25to54_T20", "F_S_HR_55to64_T20", "F_S_HR_65plus_T20")

v20 <- (1.059)^-20

temp_mort <- mortality_M_S_HR$Male_S_HR

# Iterate over each group and calculate premiums
  for (group in groups_t20) {
    group_data <- get(group)  # Get data frame for the current group
    benefits <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]
    death_benefit <- group_data$Face.amount[i] # Get death benefit
    value_Ax <- Ax_values$Female_S_HR[age]
    value_Ax20 <- Ax_values$Female_S_HR[age+20]
    value_Ex <- v20 * (1-temp_mort[age]) * (1-temp_mort[age+1]) * (1-temp_mort[age+2]) * (1-temp_mort[age+3]) * (1-temp_mort[age+4]) *     (1-temp_mort[age+5]) * (1-temp_mort[age+6]) * (1-temp_mort[age+7]) * (1-temp_mort[age+8]) * (1-temp_mort[age+9]) * (1-temp_mort[age+10]) * (1-temp_mort[age+11]) * (1-temp_mort[age+12]) * (1-temp_mort[age+13]) * (1-temp_mort[age+14]) * (1-temp_mort[age+15]) * (1-temp_mort[age+16]) * (1-temp_mort[age+17]) * (1-temp_mort[age+18]) * (1-temp_mort[age+19])
    
    benefits[i] <- calculate_epv_benefit_t20(age, death_benefit, value_Ax, value_Ex, value_Ax20)
  }
  
  t20_epv_benefits[[group]] <- benefits
}
```

# Costs
Cost = how many people use incentives * how many times they use benefit * cost of benefit

Finding cost amounts - average min and max and round to nearest US dollar

- Mental - 51.6351118760757-197.934595524957 per counseling --> $125

- Physical - Fitness Tracking - 20.0803212851406-100.401606425703 per tracker --> $60 - one time cost

- Smoking Cessation Program - 499.139414802065-1999.42627653471 per participant --> $1249 - one time cost --> 61740 smokers

Assume 100% participation for simplicity - 978582 total inforce 

Assume mental counseling session used once per month --> $1500 per year

Mental - 978582 * 1500 * 20 years = 29,357,460,000

Assume physical check in once per month for 20 years ($25 per visit)

Physical - 978582 * 60 = 58,714,920

Physical Check in - 978582 * 25 * 240 = 5,871,492,000

Assume attend program 4 times per year for 5 years and then no longer smoker

Smoking Cessation - 61740 * 1249 * 4 * 5 = 1,542,265,200

*Total Costs = 36,829,932,120*

# Summing up Premiums and EPV of Benefits

```{r}
# Remove NA columns in SPWL middle premiums data frame
new_spwl_mid_prem <- spwl_middle_premiums %>%
  select(M_NS_LR_25to54, M_NS_LR_55to64, M_NS_LR_65plus,
                               M_NS_HR_25to54, M_NS_HR_55to64, M_NS_HR_65plus,
                               M_S_HR_25to54, M_S_HR_55to64, M_S_HR_65plus,
                               F_NS_LR_25to54, F_NS_LR_55to64, F_NS_LR_65plus,
                                F_NS_HR_25to54, F_NS_HR_55to64, F_NS_HR_65plus,
                                F_S_HR_25to54, F_S_HR_55to64, F_S_HR_65plus)

# Sum up SPWL middle premiums
total_spwl_mid_prem <- sum(rowSums(new_spwl_mid_prem[1:93547, 1:18]))
total_spwl_mid_prem

# Remove NA columns in T20 middle premiums data frame
new_t20_mid_prem <- t20_middle_premiums %>%
  select(M_NS_LR_25to54, M_NS_LR_55to64,
                               M_NS_HR_25to54, M_NS_HR_55to64,
                               M_S_HR_25to54, M_S_HR_55to64,
                               F_NS_LR_25to54, F_NS_LR_55to64,
                                F_NS_HR_25to54, F_NS_HR_55to64,
                                F_S_HR_25to54, F_S_HR_55to64)

# Sum up T20 middle premiums
total_t20_mid_prem <- sum(rowSums(new_t20_mid_prem[1:189995, 1:12])) * 20
total_t20_mid_prem

# Total Premiums
total_premiums <- total_spwl_mid_prem + total_t20_mid_prem
total_premiums

```

Total SPWL Middle Premiums = 55,919,098,277

Total T20 Middle Premiums = 58,581,108

*Total Middle Premiums = 55,977,679,385*

```{r}
# Initialize a variable to store the sum
spwl_benefits_sum <- 0

# Nested for loop to iterate over each element in the 2D list
for (i in 1:length(spwl_epv_benefits)) {
  for (j in 1:length(spwl_epv_benefits[[i]])) {
    # Check if the element is not NA before adding it to the total sum
    if (!is.na(spwl_epv_benefits[[i]][j])) {
      spwl_benefits_sum <- spwl_benefits_sum + spwl_epv_benefits[[i]][j]
    }
  }
}

# Initialize a variable to store the sum
t20_benefits_sum <- 0

# Nested for loop to iterate over each element in the 2D list
for (i in 1:length(t20_epv_benefits)) {
  for (j in 1:length(t20_epv_benefits[[i]])) {
    # Check if the element is not NA before adding it to the total sum
    if (!is.na(t20_epv_benefits[[i]][j])) {
      t20_benefits_sum <- t20_benefits_sum + t20_epv_benefits[[i]][j]
    }
  }
}

spwl_benefits_sum
t20_benefits_sum

total_benefits = spwl_benefits_sum + t20_benefits_sum
total_benefits


```

Total SPWL Benefits = 912,746,156

Total T20 Benefits = -6,271,474,430

*Total Benefits = -5,358,728,273*

# Profit Calculation = Premiums - EPV of Benefits - Costs

Profit = SPWL Middle Premiums + 20 * T20 Middle Premiums - EPV of Benefits - Costs

```{r}
total_costs <- 36829932120

profit <- total_premiums - total_benefits - total_costs

profit

```

PROFIT = 24,506,475,538

# Calculating Rebates

Premium without incentives - premium with incentives = R

- 20-year term: Rebate = R * annuity immediate with n = 20
- whole life: Rebate = R * annuity immediate with n = 80 - issue age

```{r}
library(dplyr)

interest_rate <- 0.059

new_t20_diff_prem <- t20_diff_premiums %>%
  select(M_NS_LR_25to54, M_NS_LR_55to64,
                               M_NS_HR_25to54, M_NS_HR_55to64,
                               M_S_HR_25to54, M_S_HR_55to64,
                               F_NS_LR_25to54, F_NS_LR_55to64,
                                F_NS_HR_25to54, F_NS_HR_55to64,
                                F_S_HR_25to54, F_S_HR_55to64)

# Calculate a20
a_20 <- ((1 - (1 + interest_rate)^-20) / interest_rate)

# Finds rebates for t20 policies
t20_rebates <- new_t20_diff_prem * a_20

total_t20_rebates <- sum(rowSums(t20_rebates[1:189995, 1:12]))

total_t20_rebates
```

Total T20 Rebates = 40,017,245

```{r, warning=FALSE}
# Function to calculate premium for a single premium whole life policy without cash value
calculate_a_80_age <- function(age) {

  # Calculate annuity immediate with n = 80 - age
  a_80_age <- ((1 - (1.059)^-(80 - age)) / 0.059)
  
  return(a_80_age)
}

# Initialize a list to store premiums for each group
spwl_a_80_age <- list()
```

```{r, warning=FALSE}
# Define groups for SPWL policies
groups_spwl <- c("M_NS_LR_25to54_SPWL", "M_NS_LR_55to64_SPWL", "M_NS_LR_65plus_SPWL", "M_NS_HR_25to54_SPWL", "M_NS_HR_55to64_SPWL", "M_NS_HR_65plus_SPWL","M_S_HR_25to54_SPWL", "M_S_HR_55to64_SPWL", "M_S_HR_65plus_SPWL", "F_NS_LR_25to54_SPWL", "F_NS_LR_55to64_SPWL", "F_NS_LR_65plus_SPWL", "F_NS_HR_25to54_SPWL", "F_NS_HR_55to64_SPWL", "F_NS_HR_65plus_SPWL","F_S_HR_25to54_SPWL", "F_S_HR_55to64_SPWL", "F_S_HR_65plus_SPWL" )

# Iterate over each group and calculate a80-age
  for (group in groups_spwl) {
    group_data <- get(group)  # Get data frame for the current group
    annuities <- numeric(nrow(group_data))
  
  for (i in 1:nrow(group_data)) {
    age <- group_data$Issue.age[i]

    annuities[i] <- calculate_a_80_age(age)
  }
  
  spwl_a_80_age[[group]] <- annuities
  }

spwl_a_80_age_df <- as.data.frame(do.call(cbind, spwl_a_80_age))

```

```{r}
new_spwl_diff_prem <- spwl_diff_premiums %>%
  select(M_NS_LR_25to54, M_NS_LR_55to64, M_NS_LR_65plus,
                               M_NS_HR_25to54, M_NS_HR_55to64, M_NS_HR_65plus,
                               M_S_HR_25to54, M_S_HR_55to64, M_S_HR_65plus,
                               F_NS_LR_25to54, F_NS_LR_55to64, F_NS_LR_65plus,
                                F_NS_HR_25to54, F_NS_HR_55to64, F_NS_HR_65plus,
                                F_S_HR_25to54, F_S_HR_55to64, F_S_HR_65plus)

spwl_rebates <- new_spwl_diff_prem * spwl_a_80_age_df

total_spwl_rebates <- sum(rowSums(spwl_rebates[1:93547, 1:18]))
total_spwl_rebates

total_rebates = total_t20_rebates + total_spwl_rebates
total_rebates

```

Total T20 Rebates = 40,017,245

Total SPWL Rebates = 558,077,762

Total Rebates = 598,095,007

# Profit Calculation = Premiums - EPV of Benefits - Costs - Rebates

Profit = SPWL Middle Premiums + 20 * T20 Middle Premiums - EPV of Benefits - Costs - Rebates

```{r}
total_costs <- 36829932120

profit_2 <- total_premiums - total_benefits - total_costs - total_rebates

profit_2

```

PROFIT 2 (including rebates) = 23,908,380,531





